#!/bin/sh
#
# Push all branches to the kernel.org repository
#

. ~/bin/tip/tip-lib

AUTO_BRANCHES=`get_auto_branches master`
ALL_BRANCHES=`git branch | sed "s/\* //"`

PUSH_LIST=""
PUSH_FORCE_LIST=""

for BRANCH in $ALL_BRANCHES
do
    # Do not touch the local linus branch
    if [ "linus" == "$BRANCH" ]
    then
	echo "Skipping branch $BRANCH"
	continue;
    fi

    # Force autogenerated branches
    EXP=1
    FORCE=0
    for AUTO_BRANCH in $AUTO_BRANCHES
    do
	if [ "$AUTO_BRANCH" == "$BRANCH" ]
	then
	    FORCE=1
	    echo "Force update autogenerated branch $BRANCH"
	    break;
	fi
    done

    if [ "$FORCE" == "0" ]
    then
	PUSH_LIST="$PUSH_LIST $AUTO_BRANCH"
    else
	PUSH_FORCE_LIST="$PUSH_FORCE_LIST $AUTO_BRANCH"
    fi

done

echo "pushing: $PUSH_LIST"
git-push origin $PUSH_LIST || { echo error; exit 1; }

echo "force-pushing: $PUSH_FORCE_LIST"
git-push -f origin $PUSH_FORCE_LIST || { echo error; exit 1; }


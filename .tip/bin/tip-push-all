#!/bin/sh
#
# Push all branches to the kernel.org repository
#

. ~/bin/tip/tip-lib

check_master

AB=`get_auto_branches master`
BS=`git branch | sed "s/\* //"`

for B in $BS
do
    # Do not touch the local linus branch
    if [ "linus" == "$B" ]
    then 
	echo "Skipping branch $B"
	continue; 
    fi

    # Force autogenerated branches
    EXP=1
    FORCE=""
    for A in $AB
    do
	if [ "$A" == "$B" ]
	then 
	    FORCE="-f"; 
    	    echo "Force update autogenerated branch $B"
	    break;
	fi
    done

    echo "Pushing out $B"
    git-checkout $B
    git-push $FORCE origin $B || exit 1;
done

# switch back to master again
git-checkout master
